{"version":3,"sources":["./src/app/purchase/purchase.component.html","./src/app/purchase/purchase.component.ts","./src/app/purchase/purchase.module.ts"],"names":[],"mappings":"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","file":"purchase.module.chunk.js","sourcesContent":["<div class='main'>\n  <div class='message'>{{message}}</div>\n  <div [style.display]='purchaseDisplay'>\n    <h1>Ticket Information</h1>\n    <table>\n      <tr>\n        <th>Airline Name</th>\n        <th>Flight #</th>\n        <th>Departure Airport</th>\n        <th>Departure Time</th>\n        <th>Arrival Airport</th>\n        <th>Arrival Time</th>\n        <th>Price</th>\n        <th>Status</th>\n        <th>Seats</th>\n        <th>Remaining Tickets</th>\n      </tr>\n      <tr *ngFor=\"let each of result\">\n        <td>{{each.airline_name}}</td>\n        <td>{{each.flight_num}}</td>\n        <td>{{each.departure_airport}}</td>\n        <td>{{displayTime(each.departure_time)}}</td>\n        <td>{{each.arrival_airport}}</td>\n        <td>{{displayTime(each.arrival_time)}}</td>\n        <td>{{each.price}}</td>\n        <td>{{each.status}}</td>\n        <td>{{each.seats}}</td>\n        <td>{{each.remain}}</td>\n      </tr>\n    </table>\n    <form #f=\"ngForm\" (ngSubmit)=\"onSubmit(f)\">\n      <div [style.display]='customerEmailDisplay'>\n        Customer Email:\n        <input type='text' name='customer_email' placeholder='email' ngModel>\n      </div>\n      <button>Proceed to Purchase</button>\n    </form>\n    <button>Cancel</button>\n    {{purchaseMessage}}\n  </div>\n</div>\n\n\n// WEBPACK FOOTER //\n// ./src/app/purchase/purchase.component.html","import { Component, OnInit } from '@angular/core';\nimport { CookieService } from 'ngx-cookie-service';\nimport { Router } from '@angular/router';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { NgForm } from '@angular/forms';\n\n@Component({\n  selector: 'app-purchase',\n  templateUrl: './purchase.component.html',\n  styleUrls: ['./purchase.component.css']\n})\nexport class PurchaseComponent implements OnInit {\n\n  message = '';\n  purchaseMessage = '';\n  purchaseDisplay = 'none';\n  customerEmailDisplay = 'none';\n  result = [];\n\n  displayTime(datetime) {\n    const date = new Date(datetime);\n    return date.getUTCFullYear() + '-' +\n      ('00' + (date.getUTCMonth() + 1)).slice(-2) + '-' +\n      ('00' + date.getUTCDate()).slice(-2) + ' ' +\n      ('00' + date.getUTCHours()).slice(-2) + ':' +\n      ('00' + date.getUTCMinutes()).slice(-2);\n  }\n\n  getTicketInfo() {\n    this.http.post('/ticket', { 'buyTicket': this.cookie.get('buyTicket') }, { responseType: 'json' }).subscribe(\n      res => {\n        this.result.push(res);\n      }\n    );\n  }\n\n  onSubmit(f: NgForm) {\n    if (this.result[0].remain === 0) {\n      this.purchaseMessage = 'No remaining tickets, please find another flight';\n      return;\n    }\n    if (this.cookie.get('type') === 'booking_agent' && f.value.customer_email === '') {\n      this.purchaseMessage = 'Please input the customer email';\n      return;\n    }\n    [f.value.airline_name, f.value.flight_num] = this.cookie.get('buyTicket').split('/');\n    this.purchaseMessage = '';\n    this.http.post('/buy', f.value, { responseType: 'text', withCredentials: true }).subscribe(\n      res => {\n        this.purchaseMessage = 'Purchase successfully, redirecting you previous page ...';\n        setTimeout(() => {\n          this.router.navigate(['search']);\n        }, 3000);\n      },\n      err => {\n        if (err.status === 401) {\n          this.purchaseMessage = 'No remaining tickets, please find another flight';\n        } else if (err.status === 402) {\n          this.purchaseMessage = 'Authentication failed, please make sure you are logged in as customer or booking agent'\n        } else if (err.status === 403) {\n          this.purchaseMessage = 'Customer not found, please enter a valid email address';\n        } else {\n          this.purchaseMessage = 'Purchase failed, please try again';\n        }\n      }\n    );\n  }\n\n  constructor(private cookie: CookieService, private router: Router, private http: HttpClient) { }\n\n  ngOnInit() {\n    const type = this.cookie.get('type');\n    if (this.cookie.get('buyTicket') === '') {\n      this.message = 'No flight selected, redirecting you to the search page ...';\n      setTimeout(() => {\n        this.router.navigate(['search']);\n      }, 3000);\n    } else if (type === 'customer') {\n      this.purchaseDisplay = '';\n      this.getTicketInfo();\n    } else if (type === 'booking_agent') {\n      this.purchaseDisplay = '';\n      this.getTicketInfo();\n      this.customerEmailDisplay = '';\n    } else if (type === 'airline_staff') {\n      this.message = 'You cannot buy tickets as an airline staff, redirecting you to the home page ...';\n      setTimeout(() => {\n        this.router.navigate(['home']);\n      }, 3000);\n    } else {\n      this.message = 'You are not logged in yet, redirecting you to the loggin page ...';\n      setTimeout(() => {\n        this.router.navigate(['login']);\n      }, 3000);\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/purchase/purchase.component.ts","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { PurchaseComponent } from './purchase.component';\nimport { Routes, RouterModule } from '@angular/router';\nimport { NgForm, FormsModule } from '@angular/forms';\n\nconst routes: Routes = [\n  { path: '', component: PurchaseComponent }\n];\n\n@NgModule({\n  imports: [CommonModule, RouterModule.forChild(routes), FormsModule],\n  declarations: [PurchaseComponent]\n})\nexport class PurchaseModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/purchase/purchase.module.ts"],"sourceRoot":"webpack:///"}