{"version":3,"sources":["./src/app/purchase/purchase.component.css","./src/app/purchase/purchase.component.html","./src/app/purchase/purchase.component.ts","./src/app/purchase/purchase.module.ts"],"names":[],"mappings":";;;;;AAAA,yBAAyB,uBAAuB,GAAG,C;;;;;;;ACAnD,+DAA+D,SAAS,+dAA+d,mBAAmB,qBAAqB,iBAAiB,qBAAqB,wBAAwB,qBAAqB,kCAAkC,qBAAqB,sBAAsB,qBAAqB,gCAAgC,qBAAqB,YAAY,qBAAqB,aAAa,qBAAqB,YAAY,qBAAqB,aAAa,2dAA2d,iBAAiB,mB;;;;;;;;;;;;;;;;;;;ACAt5C,8EAAkD;AAClD,6FAAmD;AACnD,oFAAyC;AACzC,gFAA+D;AAQ/D;IA0DE,2BAAoB,MAAqB,EAAU,MAAc,EAAU,IAAgB;QAAvE,WAAM,GAAN,MAAM,CAAe;QAAU,WAAM,GAAN,MAAM,CAAQ;QAAU,SAAI,GAAJ,IAAI,CAAY;QAxD3F,SAAI,GAAG,EAAE,CAAC;QACV,YAAO,GAAG,EAAE,CAAC;QACb,oBAAe,GAAG,EAAE,CAAC;QACrB,oBAAe,GAAG,MAAM,CAAC;QACzB,yBAAoB,GAAG,MAAM,CAAC;QAC9B,WAAM,GAAG,EAAE,CAAC;IAmDmF,CAAC;IAjDhG,uCAAW,GAAX,UAAY,QAAQ;QAClB,IAAM,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChC,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,GAAG,GAAG;YAChC,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;YACjD,CAAC,IAAI,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;YAC1C,CAAC,IAAI,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;YAC3C,CAAC,IAAI,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;IAC5C,CAAC;IAED,yCAAa,GAAb;QAAA,iBAMC;QALC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE,EAAE,EAAE,YAAY,EAAE,MAAM,EAAE,CAAC,CAAC,SAAS,CAC1G,aAAG;YACD,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACxB,CAAC,CACF,CAAC;IACJ,CAAC;IAED,oCAAQ,GAAR,UAAS,CAAS;QAAlB,iBA8BC;QA7BC,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YAChC,IAAI,CAAC,eAAe,GAAG,kDAAkD,CAAC;YAC1E,MAAM,CAAC;QACT,CAAC;QACD,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,eAAe,IAAI,CAAC,CAAC,KAAK,CAAC,cAAc,KAAK,EAAE,CAAC,CAAC,CAAC;YACjF,IAAI,CAAC,eAAe,GAAG,iCAAiC,CAAC;YACzD,MAAM,CAAC;QACT,CAAC;QACD,4CAAoF,EAAnF,4BAAoB,EAAE,0BAAkB,CAA4C;QACrF,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;QAC1B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,KAAK,EAAE,EAAE,YAAY,EAAE,MAAM,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAC,SAAS,CACxF,aAAG;YACD,KAAI,CAAC,eAAe,GAAG,0DAA0D,CAAC;YAClF,UAAU,CAAC;gBACT,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACnC,CAAC,EAAE,IAAI,CAAC,CAAC;QACX,CAAC,EACD,aAAG;YACD,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;gBACvB,KAAI,CAAC,eAAe,GAAG,kDAAkD,CAAC;YAC5E,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC9B,KAAI,CAAC,eAAe,GAAG,wFAAwF,CAAC;YAClH,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC9B,KAAI,CAAC,eAAe,GAAG,wDAAwD,CAAC;YAClF,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,KAAI,CAAC,eAAe,GAAG,mCAAmC,CAAC;YAC7D,CAAC;QACH,CAAC,CACF,CAAC;;IACJ,CAAC;IAID,oCAAQ,GAAR;QAAA,iBAyBC;QAxBC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpC,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YACxC,IAAI,CAAC,OAAO,GAAG,4DAA4D,CAAC;YAC5E,UAAU,CAAC;gBACT,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACnC,CAAC,EAAE,IAAI,CAAC,CAAC;QACX,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC;YACpC,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;YAC1B,IAAI,CAAC,aAAa,EAAE,CAAC;QACvB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,eAAe,CAAC,CAAC,CAAC;YACzC,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC;YAC1B,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,oBAAoB,GAAG,EAAE,CAAC;QACjC,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,eAAe,CAAC,CAAC,CAAC;YACzC,IAAI,CAAC,OAAO,GAAG,kFAAkF,CAAC;YAClG,UAAU,CAAC;gBACT,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACjC,CAAC,EAAE,IAAI,CAAC,CAAC;QACX,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,OAAO,GAAG,mEAAmE,CAAC;YACnF,UAAU,CAAC;gBACT,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YAClC,CAAC,EAAE,IAAI,CAAC,CAAC;QACX,CAAC;IACH,CAAC;IArFU,iBAAiB;QAL7B,gBAAS,CAAC;YACT,QAAQ,EAAE,cAAc;;;SAGzB,CAAC;yCA2D4B,kCAAa,EAAkB,eAAM,EAAgB,iBAAU;OA1DhF,iBAAiB,CAuF7B;IAAD,wBAAC;CAAA;AAvFY,8CAAiB;;;;;;;;;;;;;;;;;ACX9B,8EAAyC;AACzC,oFAA+C;AAE/C,2FAAyD;AACzD,oFAAuD;AACvD,iFAAqD;AAErD,IAAM,MAAM,GAAW;IACrB,EAAE,IAAI,EAAE,EAAE,EAAE,SAAS,EAAE,sCAAiB,EAAE;CAC3C,CAAC;AAMF;IAAA;IAA8B,CAAC;IAAlB,cAAc;QAJ1B,eAAQ,CAAC;YACR,OAAO,EAAE,CAAC,qBAAY,EAAE,qBAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,mBAAW,CAAC;YACnE,YAAY,EAAE,CAAC,sCAAiB,CAAC;SAClC,CAAC;OACW,cAAc,CAAI;IAAD,qBAAC;CAAA;AAAlB,wCAAc","file":"purchase.module.chunk.js","sourcesContent":["module.exports = \".form {\\n    margin-top: 50px;\\n}\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/purchase/purchase.component.css\n// module id = ./src/app/purchase/purchase.component.css\n// module chunks = purchase.module","module.exports = \"<div class='main'>\\n  <div class='message'>{{message}}</div>\\n  <div [style.display]='purchaseDisplay'>\\n    <h1>Ticket Information</h1>\\n    <table>\\n      <tr>\\n        <th>Airline Name</th>\\n        <th>Flight #</th>\\n        <th>Departure Airport</th>\\n        <th>Departure Time</th>\\n        <th>Arrival Airport</th>\\n        <th>Arrival Time</th>\\n        <th>Price</th>\\n        <th>Status</th>\\n        <th>Seats</th>\\n        <th>Remaining Tickets</th>\\n      </tr>\\n      <tr *ngFor=\\\"let each of result\\\">\\n        <td>{{each.airline_name}}</td>\\n        <td>{{each.flight_num}}</td>\\n        <td>{{each.departure_airport}}</td>\\n        <td>{{displayTime(each.departure_time)}}</td>\\n        <td>{{each.arrival_airport}}</td>\\n        <td>{{displayTime(each.arrival_time)}}</td>\\n        <td>{{each.price}}</td>\\n        <td>{{each.status}}</td>\\n        <td>{{each.seats}}</td>\\n        <td>{{each.remain}}</td>\\n      </tr>\\n    </table>\\n    <form #f=\\\"ngForm\\\" class='form'>\\n      <div [style.display]='customerEmailDisplay'>\\n        <input type='text' name='customer_email' placeholder='Customer Email' ngModel required>\\n      </div>\\n      <div class='button'>\\n        <button (click)=\\\"onSubmit(f)\\\" [disabled]=\\\"f.form.invalid  && type==='booking_agent'\\\">Purchase</button>\\n        <button [routerLink]=\\\"['/search']\\\">Cancel</button>\\n      </div>\\n    </form>\\n    {{purchaseMessage}}\\n  </div>\\n</div>\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app/purchase/purchase.component.html\n// module id = ./src/app/purchase/purchase.component.html\n// module chunks = purchase.module","import { Component, OnInit } from '@angular/core';\nimport { CookieService } from 'ngx-cookie-service';\nimport { Router } from '@angular/router';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { NgForm } from '@angular/forms';\n\n@Component({\n  selector: 'app-purchase',\n  templateUrl: './purchase.component.html',\n  styleUrls: ['./purchase.component.css']\n})\nexport class PurchaseComponent implements OnInit {\n\n  type = '';\n  message = '';\n  purchaseMessage = '';\n  purchaseDisplay = 'none';\n  customerEmailDisplay = 'none';\n  result = [];\n\n  displayTime(datetime) {\n    const date = new Date(datetime);\n    return date.getUTCFullYear() + '-' +\n      ('00' + (date.getUTCMonth() + 1)).slice(-2) + '-' +\n      ('00' + date.getUTCDate()).slice(-2) + ' ' +\n      ('00' + date.getUTCHours()).slice(-2) + ':' +\n      ('00' + date.getUTCMinutes()).slice(-2);\n  }\n\n  getTicketInfo() {\n    this.http.post('/ticket', { 'buyTicket': this.cookie.get('buyTicket') }, { responseType: 'json' }).subscribe(\n      res => {\n        this.result.push(res);\n      }\n    );\n  }\n\n  onSubmit(f: NgForm) {\n    if (this.result[0].remain === 0) {\n      this.purchaseMessage = 'No remaining tickets, please find another flight';\n      return;\n    }\n    if (this.cookie.get('type') === 'booking_agent' && f.value.customer_email === '') {\n      this.purchaseMessage = 'Please input the customer email';\n      return;\n    }\n    [f.value.airline_name, f.value.flight_num] = this.cookie.get('buyTicket').split('/');\n    this.purchaseMessage = '';\n    this.http.post('/buy', f.value, { responseType: 'text', withCredentials: true }).subscribe(\n      res => {\n        this.purchaseMessage = 'Purchase successfully, redirecting you previous page ...';\n        setTimeout(() => {\n          this.router.navigate(['search']);\n        }, 3000);\n      },\n      err => {\n        if (err.status === 401) {\n          this.purchaseMessage = 'No remaining tickets, please find another flight';\n        } else if (err.status === 402) {\n          this.purchaseMessage = 'Authentication failed, please make sure you are logged in as customer or booking agent';\n        } else if (err.status === 403) {\n          this.purchaseMessage = 'Customer not found, please enter a valid email address';\n        } else {\n          this.purchaseMessage = 'Purchase failed, please try again';\n        }\n      }\n    );\n  }\n\n  constructor(private cookie: CookieService, private router: Router, private http: HttpClient) { }\n\n  ngOnInit() {\n    this.type = this.cookie.get('type');\n    if (this.cookie.get('buyTicket') === '') {\n      this.message = 'No flight selected, redirecting you to the search page ...';\n      setTimeout(() => {\n        this.router.navigate(['search']);\n      }, 3000);\n    } else if (this.type === 'customer') {\n      this.purchaseDisplay = '';\n      this.getTicketInfo();\n    } else if (this.type === 'booking_agent') {\n      this.purchaseDisplay = '';\n      this.getTicketInfo();\n      this.customerEmailDisplay = '';\n    } else if (this.type === 'airline_staff') {\n      this.message = 'You cannot buy tickets as an airline staff, redirecting you to the home page ...';\n      setTimeout(() => {\n        this.router.navigate(['home']);\n      }, 3000);\n    } else {\n      this.message = 'You are not logged in yet, redirecting you to the loggin page ...';\n      setTimeout(() => {\n        this.router.navigate(['login']);\n      }, 3000);\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/purchase/purchase.component.ts","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { PurchaseComponent } from './purchase.component';\nimport { Routes, RouterModule } from '@angular/router';\nimport { NgForm, FormsModule } from '@angular/forms';\n\nconst routes: Routes = [\n  { path: '', component: PurchaseComponent }\n];\n\n@NgModule({\n  imports: [CommonModule, RouterModule.forChild(routes), FormsModule],\n  declarations: [PurchaseComponent]\n})\nexport class PurchaseModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/purchase/purchase.module.ts"],"sourceRoot":"webpack:///"}